<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Innovate – H&S Dashboard</title>
  <style>
    :root { --brand:#C8102E; --ink:#111111; --muted:#6B7280; --card:#FFFFFF; --line:#E5E7EB; }
    *{box-sizing:border-box}
    body{margin:0;background:#ffffff;color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial}
    header{display:flex;align-items:center;gap:.75rem;padding:1rem 1.25rem;border-bottom:1px solid var(--line);position:sticky;top:0;background:#fff;z-index:5}
    header h1{font-size:1.1rem;margin:0;font-weight:700;color:var(--brand)}
    .wrap{max-width:1180px;margin:0 auto;padding:1rem;display:grid;gap:1rem}
    .kpis{display:grid;grid-template-columns:repeat(5,minmax(0,1fr));gap:1rem}
    .card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:1rem}
    .kpi h3{margin:0 0 .35rem;font-size:.85rem;color:var(--muted);font-weight:600}
    .kpi .val{font-size:1.6rem;font-weight:800;color:var(--brand)}
    .section h2{margin:0 0 .75rem;font-size:1.05rem;color:var(--brand);font-weight:800}
    .mini-grid{display:grid;grid-template-columns:repeat(5,minmax(0,1fr));gap:.75rem}
    .mini .val{font-size:1.2rem}
    table{width:100%;border-collapse:collapse}
    th,td{padding:.6rem .5rem;border-bottom:1px solid var(--line);text-align:left}
    th{color:var(--muted);font-weight:700}
    .pill{padding:.2rem .5rem;border-radius:999px;border:1px solid var(--line);display:inline-block;font-weight:700}
    .ok{color:#16A34A;border-color:#A7F3D0;background:#ECFDF5}
    .warn{color:#B45309;border-color:#FDE68A;background:#FFFBEB}
    .bad{color:#B91C1C;border-color:#FECACA;background:#FEF2F2}
    .config{background:#fafafa;border:1px dashed var(--line);border-radius:12px;padding:1rem}
    .row{display:grid;grid-template-columns:160px 1fr;gap:.75rem;align-items:center;margin:.35rem 0}
    input[type="text"], select{width:100%;padding:.55rem .6rem;border:1px solid var(--line);border-radius:10px}
    button{background:#fff;border:1px solid var(--line);border-radius:10px;padding:.6rem .9rem;color:var(--brand);cursor:pointer;font-weight:700;margin-right:.5rem}
    details summary{cursor:pointer;color:var(--brand);font-weight:800;margin-bottom:.5rem}
    .muted{color:var(--muted)}
    @media (max-width:1000px){ .kpis{grid-template-columns:repeat(3,minmax(0,1fr));} .mini-grid{grid-template-columns:repeat(3,minmax(0,1fr));} .row{grid-template-columns:1fr;} }
    @media (max-width:640px){ .kpis{grid-template-columns:repeat(2,minmax(0,1fr));} .mini-grid{grid-template-columns:repeat(2,minmax(0,1fr));} }
    @media (max-width:420px){ .kpis,.mini-grid{grid-template-columns:1fr;} }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <header>
    <h1>Innovate – Health & Safety Dashboard</h1>
  </header>

  <main class="wrap">
    <!-- CONFIG PANEL -->
    <section class="config card">
      <details open>
        <summary>Data connection & mapping (click to collapse)</summary>
        <div class="row"><label>CSV URL</label><input id="csvUrl" type="text" value="https://docs.google.com/spreadsheets/d/e/2PACX-1vTXQVIPN42E20By0btiM2IFinhYkeNeYuz66b7bA5QEukcD_gLN-g7LGyArw05zaMJssbMxJm68DAkX/pub?gid=2117097934&single=true&output=csv"></div>
        <div class="row"><label>Mode</label>
          <select id="mode">
            <option value="columns">Totals in columns (one row has all totals)</option>
            <option value="events">Event rows (count by Type value)</option>
          </select>
        </div>
        <!-- Add your mapping inputs here (Safe Behaviour, Near Miss, etc) -->
        <p class="muted">Enter your exact sheet column headers or event values in the boxes to match your data.</p>
        <div style="margin-top:.5rem">
          <button id="reloadBtn">Reload data</button>
          <span class="muted" id="statusText"></span>
        </div>
      </details>
    </section>

    <!-- KPI boxes -->
    <section class="kpis">
      <div class="card kpi"><h3>Total Behaviour</h3><div id="totalBehaviour" class="val">—</div></div>
      <div class="card kpi"><h3>Total Incidents & Accidents</h3><div id="totalEvents" class="val">—</div></div>
      <div class="card kpi"><h3>Total Man Hours (YTD)</h3><div id="hoursYTD" class="val">—</div></div>
      <div class="card kpi"><h3>LTIFR (YTD)</h3><div id="ltifrYTD" class="val">—</div></div>
      <div class="card kpi"><h3>LTI (YTD)</h3><div id="ltiYTD" class="val">—</div></div>
    </section>

    <!-- Mini breakdown -->
    <section class="section card">
      <h2>Behaviour & Event Snapshots</h2>
      <div class="mini-grid">
        <div class="card kpi mini"><h3>Safe Behaviour</h3><div id="sb" class="val">—</div></div>
        <div class="card kpi mini"><h3>Unsafe Behaviour</h3><div id="ub" class="val">—</div></div>
        <div class="card kpi mini"><h3>Safe Condition</h3><div id="sc" class="val">—</div></div>
        <div class="card kpi mini"><h3>Unsafe Condition</h3><div id="uc" class="val">—</div></div>
        <div class="card kpi mini"><h3>Positive Behaviour</h3><div id="pb" class="val">—</div></div>
        <div class="card kpi mini"><h3>Near Miss</h3><div id="nm" class="val">—</div></div>
        <div class="card kpi mini"><h3>Incident</h3><div id="in" class="val">—</div></div>
        <div class="card kpi mini"><h3>Accident</h3><div id="ac" class="val">—</div></div>
        <div class="card kpi mini"><h3>Property/Equip Damage</h3><div id="pd" class="val">—</div></div>
        <div class="card kpi mini"><h3>Fatality</h3><div id="fa" class="val">—</div></div>
      </div>
    </section>

    <!-- Compliance -->
    <section class="section card" id="complianceSection">
      <h2>Compliance – Days Left</h2>
      <table>
        <thead><tr><th>Item</th><th>Due Date</th><th>Days Left</th><th>Status</th></tr></thead>
        <tbody id="complianceBody"></tbody>
      </table>
    </section>
  </main>

<script>
// super simple CSV fetch + parse
function csvToArray(text){
  return text.trim().split(/\\r?\\n/).map(r => r.split(','));
}

async function loadData(){
  const url = document.getElementById('csvUrl').value.trim();
  document.getElementById('statusText').textContent = "Fetching…";
  const res = await fetch(url);
  if(!res.ok){ alert("Could not load CSV: "+res.status); return; }
  const text = await res.text();
  const rows = csvToArray(text);
  document.getElementById('statusText').textContent = "Loaded "+rows.length+" rows";
  console.log(rows);
  // TODO: map to your KPIs using exact column names
}

document.getElementById('reloadBtn').addEventListener('click', loadData);
</script>
</body>
</html>
